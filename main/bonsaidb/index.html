<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="BonsaiDb aims to be a Rust-written, ACID-compliant, document-database inspired by CouchDB. While it is inspired by CouchDB, this project will not aim to be compatible with existing CouchDB servers, and it will be implementing its own replication, clustering, and sharding strategies."><meta name="keywords" content="rust, rustlang, rust-lang, bonsaidb"><title>bonsaidb - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../bonsaidb/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Crate bonsaidb</h2><div class="block version"><div class="narrow-helper"></div><p>Version 0.1.0-dev.4</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all bonsaidb's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#enums">Enums</a></li></ul></div><div id="sidebar-vars" data-name="bonsaidb" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">bonsaidb</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/bonsaidb/lib.rs.html#1-43" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>BonsaiDb aims to be a <a href="https://rust-lang.org">Rust</a>-written, ACID-compliant, document-database inspired by <a href="https://couchdb.apache.org/">CouchDB</a>. While it is inspired by CouchDB, this project will not aim to be compatible with existing CouchDB servers, and it will be implementing its own replication, clustering, and sharding strategies.</p>
<h3 id="project-goals" class="section-header"><a href="#project-goals">Project Goals</a></h3>
<p>The high-level goals for this project are:</p>
<ul>
<li>☑️ Be able to build a document-based database’s schema using Rust types.</li>
<li>☑️ Run within your Rust binary, simplifying basic deployments.</li>
<li>☑️ Run as a local-only file-based database with no networking involved.</li>
<li>☑️ Run as a networked server using QUIC with TLS enabled by default.</li>
<li>☑️ Expose a Publish/Subscribe eventing system.</li>
<li>☐ Expose a Job queue and scheduling system – a la <a href="https://sidekiq.org/">Sidekiq</a> or <a href="https://aws.amazon.com/sqs/">SQS</a> (tracking issue <a href="https://github.com/khonsulabs/bonsaidb/issues/78">#78</a>)</li>
<li>☐ Easily set up read-replicas between multiple servers (tracking issue <a href="https://github.com/khonsulabs/bonsaidb/issues/90">#90</a>)</li>
<li>☐ Easily run a highly-available quorum-based cluster across at least 3 servers (tracking issue <a href="https://github.com/khonsulabs/bonsaidb/issues/104">#104</a>)</li>
</ul>
<h3 id="-status-of-this-project" class="section-header"><a href="#-status-of-this-project">⚠️ Status of this project</a></h3>
<p><strong>You should not attempt to use this software in anything except for experiments.</strong> This project is under active development (<img src="https://img.shields.io/github/commit-activity/m/khonsulabs/bonsaidb" alt="GitHub commit activity" />), but at the point of writing this README, the project is too early to be used.</p>
<p>If you’re interested in chatting about this project or potentially wanting to contribute, come chat with us on Discord: <a href="https://discord.khonsulabs.com/"><img src="https://img.shields.io/discord/578968877866811403" alt="Discord" /></a>.</p>
<h3 id="example" class="section-header"><a href="#example">Example</a></h3>
<p>Check out <a href="https://github.com/khonsulabs/bonsaidb/tree/main/examples">./examples</a> for examples. To get an idea of how it works, this is a simple schema:</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>, <span class="ident">Serialize</span>, <span class="ident">Deserialize</span>)]</span>
<span class="kw">struct</span> <span class="ident">Shape</span> {
    <span class="kw">pub</span> <span class="ident">sides</span>: <span class="ident">u32</span>,
}

<span class="kw">impl</span> <span class="ident">Collection</span> <span class="kw">for</span> <span class="ident">Shape</span> {
    <span class="kw">fn</span> <span class="ident">collection_name</span>() -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">CollectionName</span>, <span class="ident">InvalidNameError</span><span class="op">&gt;</span> {
        <span class="ident">CollectionName::new</span>(<span class="string">&quot;khonsulabs&quot;</span>, <span class="string">&quot;shapes&quot;</span>)
    }

    <span class="kw">fn</span> <span class="ident">define_views</span>(<span class="ident">schema</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">Schematic</span>) -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span>(), <span class="ident">Error</span><span class="op">&gt;</span> {
        <span class="ident">schema</span>.<span class="ident">define_view</span>(<span class="ident">ShapesByNumberOfSides</span>)
    }
}

<span class="kw">impl</span> <span class="ident">DefaultSerializedCollection</span> <span class="kw">for</span> <span class="ident">Shape</span> {}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">struct</span> <span class="ident">ShapesByNumberOfSides</span>;

<span class="kw">impl</span> <span class="ident">CollectionView</span> <span class="kw">for</span> <span class="ident">ShapesByNumberOfSides</span> {
    <span class="kw">type</span> <span class="ident">Collection</span> <span class="op">=</span> <span class="ident">Shape</span>;

    <span class="kw">type</span> <span class="ident">Key</span> <span class="op">=</span> <span class="ident">u32</span>;

    <span class="kw">type</span> <span class="ident">Value</span> <span class="op">=</span> <span class="ident">usize</span>;

    <span class="kw">fn</span> <span class="ident">version</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="ident">u64</span> {
        <span class="number">1</span>
    }

    <span class="kw">fn</span> <span class="ident">name</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">Name</span>, <span class="ident">InvalidNameError</span><span class="op">&gt;</span> {
        <span class="ident">Name::new</span>(<span class="string">&quot;by-number-of-sides&quot;</span>)
    }

    <span class="kw">fn</span> <span class="ident">map</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">document</span>: <span class="ident">CollectionDocument</span><span class="op">&lt;</span><span class="ident">Shape</span><span class="op">&gt;</span>) -&gt; <span class="ident">MapResult</span><span class="op">&lt;</span><span class="ident"><span class="self">Self</span>::Key</span>, <span class="ident"><span class="self">Self</span>::Value</span><span class="op">&gt;</span> {
        <span class="prelude-val">Ok</span>(<span class="ident">document</span>.<span class="ident">emit_key_and_value</span>(<span class="ident">document</span>.<span class="ident">contents</span>.<span class="ident">sides</span>, <span class="number">1</span>))
    }

    <span class="kw">fn</span> <span class="ident">reduce</span>(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        <span class="ident">mappings</span>: <span class="kw-2">&amp;</span>[<span class="ident">MappedValue</span><span class="op">&lt;</span><span class="ident"><span class="self">Self</span>::Key</span>, <span class="ident"><span class="self">Self</span>::Value</span><span class="op">&gt;</span>],
        <span class="ident">_rereduce</span>: <span class="ident">bool</span>,
    ) -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident"><span class="self">Self</span>::Value</span>, <span class="ident">view::Error</span><span class="op">&gt;</span> {
        <span class="prelude-val">Ok</span>(<span class="ident">mappings</span>.<span class="ident">iter</span>().<span class="ident">map</span>(<span class="op">|</span><span class="ident">m</span><span class="op">|</span> <span class="ident">m</span>.<span class="ident">value</span>).<span class="ident">sum</span>())
    }
}</code></pre></div>
<p>After you have your collection(s) defined, you can open up a database and insert documents:</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code>    <span class="kw">let</span> <span class="ident">db</span> <span class="op">=</span> <span class="ident">Database::open</span>::<span class="op">&lt;</span><span class="ident">Shape</span><span class="op">&gt;</span>(<span class="ident">StorageConfiguration::new</span>(<span class="string">&quot;view-examples.bonsaidb&quot;</span>)).<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Insert a new document into the Shape collection.</span>
    <span class="ident">Shape::new</span>(<span class="number">3</span>).<span class="ident">push_into</span>(<span class="kw-2">&amp;</span><span class="ident">db</span>).<span class="kw">await</span><span class="question-mark">?</span>;</code></pre></div>
<p>And query data using the Map-Reduce-powered view:</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="kw">let</span> <span class="ident">triangles</span> <span class="op">=</span> <span class="ident">db</span>
    .<span class="ident">view</span>::<span class="op">&lt;</span><span class="ident">ShapesByNumberOfSides</span><span class="op">&gt;</span>()
    .<span class="ident">with_key</span>(<span class="number">3</span>)
    .<span class="ident">query</span>()
    .<span class="kw">await</span><span class="question-mark">?</span>;
<span class="macro">println!</span>(<span class="string">&quot;Number of triangles: {}&quot;</span>, <span class="ident">triangles</span>.<span class="ident">len</span>());</code></pre></div>
<p>See the <a href="https://github.com/khonsulabs/bonsaidb/blob/main/examples/README.md">examples README</a> for a list of all available examples.</p>
<h3 id="why-write-another-database" class="section-header"><a href="#why-write-another-database">Why write another database?</a></h3>
<ul>
<li>Deploying highly-available databases is hard (and often expensive). It doesn’t need to be.</li>
<li>We are passionate Rustaceans and are striving for an ideal of supporting a 100% Rust-based deployment ecosystem for newly written software.</li>
<li>Specifically for the founding author <a href="https://github.com/ecton">@ecton</a>, the idea for this design dates back to thoughts of fun side-projects while running my last business which was built atop CouchDB. Working on this project is fulfilling a long-time desire of his.</li>
</ul>
<h3 id="feature-flags" class="section-header"><a href="#feature-flags">Feature Flags</a></h3>
<p>No feature flags are enabled by default in the <code>bonsaidb</code> crate. This is
because in most Rust executables, you will only need a subset of the
functionality. If you’d prefer to enable everything, you can use the <code>full</code>
feature:</p>
<div class="example-wrap"><pre class="language-toml"><code>[dependencies]
bonsaidb = { version = &quot;*&quot;, default-features = false, features = &quot;full&quot; }</code></pre></div>
<ul>
<li><code>full</code>: Enables <code>local-full</code>, <code>server-full</code>, and <code>client-full</code>.</li>
<li><code>cli</code>: Enables the <code>bonsaidb</code> executable.</li>
</ul>
<h4 id="local-databases-only" class="section-header"><a href="#local-databases-only">Local databases only</a></h4><div class="example-wrap"><pre class="language-toml"><code>[dependencies]
bonsaidb = { version = &quot;*&quot;, default-features = false, features = &quot;local-full&quot; }</code></pre></div>
<ul>
<li><code>local-full</code>: Enables all the flags below</li>
<li><code>local</code>: Enables the <a href="https://dev.bonsaidb.io/main/bonsaidb/local/"><code>local</code></a> module, which re-exports the crate
<code>bonsaidb-local</code>.</li>
<li><code>local-cli</code>: Enables the <code>StructOpt</code> structures for embedding database
management commands into your own command-line interface.</li>
<li><code>local-encryption</code>: Enables at-rest encryption.</li>
<li><code>local-instrument</code>: Enables instrumenting with <code>tracing</code>.</li>
<li><code>local-multiuser</code>: Enables multi-user support.</li>
</ul>
<h4 id="bonsaidb-server" class="section-header"><a href="#bonsaidb-server"><code>BonsaiDb</code> server</a></h4><div class="example-wrap"><pre class="language-toml"><code>[dependencies]
bonsaidb = { version = &quot;*&quot;, default-features = false, features = &quot;server-full&quot; }</code></pre></div>
<ul>
<li><code>server-full</code>: Enables all the flags below,</li>
<li><code>server</code>: Enables the <a href="https://dev.bonsaidb.io/main/bonsaidb/server/"><code>server</code></a> module, which re-exports the crate
<code>bonsaidb-server</code>.</li>
<li><code>server-acme</code>: Enables automtic certificate acquisition through ACME/LetsEncrypt.</li>
<li><code>server-cli</code>: Enables the <code>cli</code> module.</li>
<li><code>server-encryption</code>: Enables at-rest encryption.</li>
<li><code>server-hyper</code>: Enables convenience functions for upgrading websockets using <code>hyper</code>.</li>
<li><code>server-instrument</code>: Enables instrumenting with <code>tracing</code>.</li>
<li><code>server-pem</code>: Enables the ability to install a certificate using the PEM format.</li>
<li><code>server-websockets</code>: Enables <code>WebSocket</code> support.</li>
</ul>
<h4 id="client-for-accessing-a-bonsaidb-server" class="section-header"><a href="#client-for-accessing-a-bonsaidb-server">Client for accessing a <code>BonsaiDb</code> server</a></h4><div class="example-wrap"><pre class="language-toml"><code>[dependencies]
bonsaidb = { version = &quot;*&quot;, default-features = false, features = &quot;client-full&quot; }</code></pre></div>
<ul>
<li><code>client-full</code>: Enables <code>client</code>, <code>client-trusted-dns</code> and <code>client-websockets</code></li>
<li><code>client</code>: Enables the <a href="https://dev.bonsaidb.io/main/bonsaidb/client/"><code>client</code></a> module, which re-exports the crate
<code>bonsaidb-client</code>.</li>
<li><code>client-trusted-dns</code>: Enables using trust-dns for DNS resolution. If not
enabled, all DNS resolution is done with the OS’s default name resolver.</li>
<li><code>client-websockets</code>: Enables <code>WebSocket</code> support for <code>bonsaidb-client</code>.</li>
</ul>
<h3 id="developing-bonsaidb" class="section-header"><a href="#developing-bonsaidb">Developing BonsaiDb</a></h3><h4 id="pre-commit-hook" class="section-header"><a href="#pre-commit-hook">Pre-commit hook</a></h4>
<p>Our CI processes require that some commands succeed without warnings or errors. These checks can be performed manually by running:</p>
<div class="example-wrap"><pre class="language-bash"><code>cargo xtask test --fail-on-warnings</code></pre></div>
<p>Or, if you would like to run all these checks before each commit, you can install the check as a pre-commit hook:</p>
<div class="example-wrap"><pre class="language-bash"><code>cargo xtask install-pre-commit-hook</code></pre></div><h3 id="open-source-licenses" class="section-header"><a href="#open-source-licenses">Open-source Licenses</a></h3>
<p>This project, like all projects from <a href="https://khonsulabs.com/">Khonsu Labs</a>, are
open-source. This repository is available under the <a href="./LICENSE-MIT">MIT License</a>
or the <a href="./LICENSE-APACHE">Apache License 2.0</a>.</p>
<p>To learn more about contributing, please see <a href="./CONTRIBUTING.md">CONTRIBUTING.md</a>.</p>
</div></details><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="cli/index.html" title="bonsaidb::cli mod">cli</a></div><div class="item-right docblock-short"><p><code>BonsaiDb</code> command line tools.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="client/index.html" title="bonsaidb::client mod">client</a></div><div class="item-right docblock-short"><p>Client for <code>bonsaidb-server</code>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="core/index.html" title="bonsaidb::core mod">core</a></div><div class="item-right docblock-short"><p>Core functionality and types for <code>BonsaiDb</code>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="keystorage/index.html" title="bonsaidb::keystorage mod">keystorage</a></div><div class="item-right docblock-short"><p><code>VaultKeyStorage</code> implementors.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="local/index.html" title="bonsaidb::local mod">local</a></div><div class="item-right docblock-short"><p>Local storage backend for <code>BonsaiDb</code>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="server/index.html" title="bonsaidb::server mod">server</a></div><div class="item-right docblock-short"><p>The <code>BonsaiDb</code> Server.</p>
</div></div></div><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.AnyDatabase.html" title="bonsaidb::AnyDatabase enum">AnyDatabase</a></div><div class="item-right docblock-short"><p>A database connection that can be either from a local server or a server
over a network connection.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.AnyServerConnection.html" title="bonsaidb::AnyServerConnection enum">AnyServerConnection</a></div><div class="item-right docblock-short"><p>A local server or a server over a network connection.</p>
</div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="bonsaidb" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script>
</body></html>