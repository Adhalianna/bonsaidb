<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Networked - PliantDb User&#x27;s Guide</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">About PliantDb</li><li class="chapter-item expanded "><a href="../about/concepts.html"><strong aria-hidden="true">1.</strong> Concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../about/concepts/document.html"><strong aria-hidden="true">1.1.</strong> Document</a></li><li class="chapter-item expanded "><a href="../about/concepts/collection.html"><strong aria-hidden="true">1.2.</strong> Collection</a></li><li class="chapter-item expanded "><a href="../about/concepts/view.html"><strong aria-hidden="true">1.3.</strong> View</a></li><li class="chapter-item expanded "><a href="../about/concepts/schema.html"><strong aria-hidden="true">1.4.</strong> Schema</a></li><li class="chapter-item expanded "><a href="../about/concepts/database.html"><strong aria-hidden="true">1.5.</strong> Database</a></li><li class="chapter-item expanded "><a href="../about/concepts/server.html"><strong aria-hidden="true">1.6.</strong> Server</a></li><li class="chapter-item expanded "><a href="../about/concepts/client.html"><strong aria-hidden="true">1.7.</strong> Client</a></li><li class="chapter-item expanded "><a href="../about/concepts/pubsub.html"><strong aria-hidden="true">1.8.</strong> PubSub</a></li></ol></li><li class="chapter-item expanded "><a href="../about/access_models.html"><strong aria-hidden="true">2.</strong> How can PliantDb be accessed?</a></li><li class="chapter-item expanded affix "><li class="part-title">Integration</li><li class="chapter-item expanded "><a href="../integration/overview.html"><strong aria-hidden="true">3.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../integration/local.html"><strong aria-hidden="true">4.</strong> Local</a></li><li class="chapter-item expanded "><a href="../integration/server.html" class="active"><strong aria-hidden="true">5.</strong> Networked</a></li><li class="chapter-item expanded "><a href="../integration/cluster.html"><strong aria-hidden="true">6.</strong> Clustered (upcoming)</a></li><li class="chapter-item expanded affix "><li class="part-title">Core Traits</li><li class="chapter-item expanded "><a href="../traits/connection.html"><strong aria-hidden="true">7.</strong> Connection</a></li><li class="chapter-item expanded "><a href="../traits/server_connection.html"><strong aria-hidden="true">8.</strong> ServerConnection</a></li><li class="chapter-item expanded "><a href="../traits/pubsub.html"><strong aria-hidden="true">9.</strong> PubSub/Subscriber</a></li><li class="chapter-item expanded "><a href="../traits/kv.html"><strong aria-hidden="true">10.</strong> Kv</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">PliantDb User&#x27;s Guide</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="integrating-the-networked-pliantdb-server"><a class="header" href="#integrating-the-networked-pliantdb-server">Integrating the networked PliantDb Server</a></h1>
<p>To access <code>PliantDb</code> over the network, you're going to be writing two pieces of code: the server code and the client code.</p>
<h2 id="your-pliantdb-server"><a class="header" href="#your-pliantdb-server">Your PliantDb Server</a></h2>
<p>The first step is to create a <a href="https://pliantdb.dev/main/pliantdb/local/struct.Storage.html"><code>Server</code></a>, which uses local <a href="https://pliantdb.dev/main/pliantdb/local/struct.Storage.html"><code>Storage</code></a> under the hood. This means that if you're already using <code>PliantDb</code> in local mode, you can swap your usage of <a href="https://pliantdb.dev/main/pliantdb/local/struct.Storage.html"><code>Storage</code></a> with <a href="https://pliantdb.dev/main/pliantdb/server/struct.Server.html"><code>Server</code></a> in your server code without running your database through any tools. Here's the setup code from <a href="https://github.com/khonsulabs/pliantdb/blob/main/pliantdb/examples/server.rs"><code>pliantdb/examples/server.rs</code></a></p>
<pre><code class="language-rust noplayground no_run">    let server = Server::open(
        Path::new(&quot;server-data.pliantdb&quot;),
        Configuration::default(),
    )
    .await?;
    if server.certificate().await.is_err() {
        server
            .install_self_signed_certificate(&quot;example-server&quot;, true)
            .await?;
    }
    let certificate = server.certificate().await?;
    server.register_schema::&lt;Shape&gt;().await?;
    match server.create_database::&lt;Shape&gt;(&quot;my-database&quot;).await {
        Ok(()) =&gt; {}
        Err(Error::DatabaseNameAlreadyTaken(_)) =&gt; {}
        Err(err) =&gt; panic!(
            &quot;Unexpected error from server during create_database: {:?}&quot;,
            err
        ),
    }
</code></pre>
<p>Once you have a server initialized, calling <a href="https://pliantdb.dev/main/pliantdb/server/struct.Server.html#method.listen_on"><code>listen_on</code></a> will begin listening for connections on the port specified. This uses the preferred native protocol which uses UDP. If you find that UDP is not working for your setup or want to put <code>PliantDb</code> behind a load balancer that doesn't support UDP, you can enable WebSocket support and call <a href="https://pliantdb.dev/main/pliantdb/server/struct.Server.html#method.listen_for_websockets_on"><code>listen_for_websockets_on</code></a>.</p>
<p>You can call both, but since these functions don't return until the server is shut down, you should spawn them instead:</p>
<pre><code class="language-rust noplayground no_run">let task_server = server.clone();
tokio::spawn(async move {
    task_server.listen_on(5645).await
});
let server = server.clone();
tokio::spawn(async move {
    task_server.listen_for_websockets_on(&quot;localhost:8080&quot;).await
});
</code></pre>
<p>If you're not running any of your own code on the server, and you're only using one listening method, you can just await the listen method of your choice in your server's main.</p>
<!-- TODO: Certificates -->
<h2 id="from-the-client"><a class="header" href="#from-the-client">From the Client</a></h2>
<p>The <a href="https://pliantdb.dev/main/pliantdb/client/struct.Client.html"><code>Client</code></a> can support both the native protocol and WebSockets. It determines which protocol to use based on the scheme in the URL:</p>
<ul>
<li><code>pliantdb://host:port</code> will connect using the native <code>PliantDb</code> protocol.</li>
<li><code>ws://host:port</code> will connect using WebSockets.</li>
</ul>
<p>Here's how to connect, from <a href="https://github.com/khonsulabs/pliantdb/blob/main/pliantdb/examples/server.rs"><code>pliantdb/examples/server.rs</code></a>:</p>
<pre><code class="language-rust noplayground no_run">Client::new(
    Url::parse(&quot;pliantdb://localhost:5645&quot;)?,
    Some(certificate),
)
.await?
</code></pre>
<p>This is using a pinned certificate to connect. Other methods are supported, but better certificate management is coming soon.</p>
<!-- TODO: Certificates -->
<h2 id="common-traits"><a class="header" href="#common-traits">Common Traits</a></h2>
<ul>
<li><a href="https://pliantdb.dev/main/pliantdb/server/struct.Server.html"><code>Server</code></a> implements <a href="../traits/server_connection.html"><code>ServerConnection</code></a>.</li>
<li><a href="https://pliantdb.dev/main/pliantdb/server/struct.Server.html#method.database"><code>Server::database()</code></a> returns a local <a href="https://pliantdb.dev/main/pliantdb/local/struct.Database.html"><code>Database</code></a>, which implements <a href="../traits/connection.html"><code>Connection</code></a>, <a href="../traits/kv.html"><code>Kv</code></a>, and <a href="../traits/kv.html"><code>PubSub</code></a>. Local access in the server executable doesn't go over the network.</li>
<li><a href="https://pliantdb.dev/main/pliantdb/client/struct.Client.html"><code>Client</code></a> implements <a href="../traits/server_connection.html"><code>ServerConnection</code></a>.</li>
<li><a href="https://pliantdb.dev/main/pliantdb/client/struct.Client.html#method.database"><code>Client::database()</code></a> returns a <a href="https://pliantdb.dev/main/pliantdb/client/struct.RemoteDatabase.html"><code>RemoteDatabase</code></a>, which implements <a href="../traits/connection.html"><code>Connection</code></a>, <a href="../traits/kv.html"><code>Kv</code></a>, and <a href="../traits/kv.html"><code>PubSub</code></a>.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../integration/local.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../integration/cluster.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../integration/local.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../integration/cluster.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="../mermaid.min.js"></script>
        
        <script type="text/javascript" src="../mermaid-init.js"></script>
        

        

    </body>
</html>
